# Risk-averse optimization of genetic circuits under uncertainty

Code for the [Risk-averse optimization of genetic circuits under uncertainty](https://www.biorxiv.org/content/10.1101/2024.11.13.623219v1) by Michal Kobiela, Diego Oyarzún, and Michael Gutmann.

## Overview
Synthetic biology aims to engineer biological systems with specified functions. This requires navigating an extensive design space, which is challenging to achieve with wet lab experiments alone. To expedite the design process, mathematical modelling is typically employed to predict circuit function in silico ahead of implementation, which when coupled with computational optimization can be used to automatically identify promising designs. However, circuit models are inherently inaccurate which can result in sub-optimal or non-functional in vivo performance. To mitigate this issue, here we propose to combine Bayesian inference, Thompson sampling, and risk management to find optimal circuit designs. Our approach employs data from non-functional designs to estimate the distribution of the model parameters and then employs risk-averse optimization to select design parameters that are expected to perform well given parameter uncertainty and biomolecular noise. We illustrate the approach by designing robust adaptation circuits and genetic oscillators with a prescribed frequency. The proposed approach provides a novel methodology for the design of robust genetic circuitry.

Toml files with Julia environments are provided. The data can be found on Zenodo (https://zenodo.org/records/13355081).

Licence: CC-BY 4.0

If you find the code helpful, please cite:

> Kobiela, Michal, Diego A. Oyarzun, and Michael U. Gutmann. *Risk-averse optimization of genetic circuits under uncertainty.*


## Getting started

1. **Clone the repository**

```bash
git clone https://github.com/MichalKobiela/uncertainty-circ-opt.git
cd uncertainty-circ-opt
```

2. Install Julia (≥ 1.11)

See [https://julialang.org/downloads/](https://julialang.org/downloads/).

3. Activate environment

Each subproject (Repressilator, RPA, RPARealData, HostAwareRepressilator) has its own Julia environment. For example:

```
cd RPA
using Pkg
Pkg.activate(".")
Pkg.instantiate()

```

4. Data availability

Data can be found on [Zenodo](https://zenodo.org/records/13355081). It contains all the data files generated by this repo and plotting scripts to replicate the paper figures.

5. Running the code

Each subproject contains scripts for:

- Model definition (e.g. Model/*.jl)

- Inference to estimate parameters from data (e.g. SMC or MCMC scripts in Inference/*.jl)

- Design optimization to select robust parameters under uncertainty (Design/*.jl)

- Evaluation to assess design performance (Evaluation/*.jl or Eval/*.jl)

For example, to run inference for the RPA:
```
cd RPA/Inference
include("mcmc.jl")
```

The repository structure is as follows:

```
.
├── README.md
├── Repressilator - Study 2.3 Repressilator
│   ├── Design
│   │   ├── amplitude_match.jl         # Check whether the loss function is sensitive to amplitude
│   │   ├── optimization_prior.jl      # Acquisition of prior optimization samples
│   │   ├── setup_opt.jl               # Setup of optimization
│   │   └── thompson.jl                # Acquisition of Thompson samples
│   ├── Evaluation
│   │   ├── eval.jl                    # Evaluation of Thompson samples
│   │   ├── eval_prior.jl              # Evaluation of prior optimization samples
│   │   └── exemplar.jl                # Evaluation of exemplar designs
│   ├── Inference
│   │   ├── smc.jl                     # SMC ABC inference
│   │   ├── Project.toml
│   │   ├── Manifest.toml
│   │   └── readme.txt
│   ├── Model
│   │   └── repressilator_model.jl     # Mathematical model of the Repressilator
│   ├── Project.toml
│   └── Manifest.toml
│
├── RPA - Study 2.1 Adaptation study: simulation
│   ├── Design
│   │   ├── Optimization_prior.jl      # Acquisition of prior optimization samples
│   │   └── Thompson.jl                # Acquisition of Thompson samples
│   ├── Evaluation
│   │   ├── eval.jl                    # Evaluation of Thompson samples
│   │   ├── eval_prior.jl              # Evaluation of prior optimization samples
│   │   └── exemplar_designs.jl        # Evaluation of exemplar designs
│   ├── Inference
│   │   ├── mcmc.jl                    # MCMC inference (NUTS)
│   │   └── save_posterior.jl          # Save posterior to CSV file
│   ├── Model
│   │   └── rpa_ode.jl                 # Mathematical model of the RPA circuit
│   ├── Project.toml
│   └── Manifest.toml
│
├── RPARealData - Study 2.2 Adaptation study: real data
│   ├── Design
│   │   └── thompson.jl                # Thompson sampling for real data
│   ├── Evaluation
│   │   ├── evaluation.jl              # Evaluation scripts
│   │   └── posterior_predictive.jl    # Posterior predictive evaluation of exemplar designs and held-out observations
│   ├── Inference
│   │   ├── inference.jl               # Inference from real data
│   │   ├── data.csv                   # Observed data
│   │   └── time_points.csv            # Observation time points
│   ├── Model
│   │   └── model.jl                   # Model for RPA real data analysis
│   ├── Project.toml
│   └── Manifest.toml
│
└── HostAwareRepressilator - Study 2.4 Host-aware represssilator
    ├── Design
    │   ├── setup.jl                   # Setup for design
    │   └── thompson.jl                # Thompson sampling
    ├── Eval
    │   ├── eval.jl                    # Evaluation scripts
    │   └── examplar.jl                # Evaluation of exemplar designs
    ├── Inference
    │   └── smc.jl                     # SMC ABC inference
    ├── Model
    │   ├── reprissilator_host.jl      # Host-aware repressilator model
    │   ├── warmUp1.jl                 # Calculate initialization for the warmUp2.jl
    │   └── warmUp2.jl                 # Calculate initialization for the repressialtor_host.jl
    ├── Project.toml
    └── Manifest.toml
```
